<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skills - Pranav Kowadkar</title>
    <!-- Custom pk favicon -->
    <link rel="icon" href="./static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="./static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="./static/css/chatbot.css">
    <meta name="description" content="Pranav Kowadkar's technical skills and competencies in data science, machine learning, programming, and more.">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles from style.css might be here - keep them */
        
        /* --- Start: Soap Bubble Styles --- */
        .skills-section {
            position: relative;
            min-height: 150vh;
            width: 100%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000000;
            padding: 0;
        }

        .skills-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(20, 20, 20, 0.8) 0%, rgba(0, 0, 0, 1) 100%);
            z-index: 0;
        }

        #skill-tree-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .bubble {
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .bubble text {
            pointer-events: none;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            font-size: 14px;
            fill: #ffffff;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
        }
        
        #skill-card {
            position: absolute;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border-radius: 15px;
            padding: 25px;
            width: 320px;
            box-shadow: 0 0 25px rgba(229, 9, 20, 0.4);
            border: 1px solid rgba(229, 9, 20, 0.3);
            transform: translate(-50%, -50%);
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }
        
        #skill-card.visible {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
            animation: cardAppear 0.3s ease forwards;
        }
        
        .card-content {
            color: #ffffff;
            font-family: 'Roboto', sans-serif;
        }
        
        .skill-name {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #E50914;
            text-align: center;
            border-bottom: 1px solid rgba(229, 9, 20, 0.2);
            padding-bottom: 8px;
        }
        
        .skill-description {
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 18px;
            opacity: 0.9;
            text-align: center;
        }
        
        .projects-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .project-item {
            background: rgba(229, 9, 20, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            border: 1px solid rgba(229, 9, 20, 0.2);
            transition: all 0.3s ease;
        }
        
        .project-item:hover {
            background: rgba(229, 9, 20, 0.25);
            transform: translateX(5px);
            color: #fff;
        }
        
        @keyframes cardAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        @media (max-width: 768px) {
            #skill-card {
                width: 90%;
                max-width: 300px;
                padding: 20px;
            }
            
            .bubble text {
                font-size: 12px;
            }
             .skill-name {
                 font-size: 22px;
             }
             .skill-description {
                 font-size: 14px;
             }
        }
        /* --- End: Soap Bubble Styles --- */

        /* Footer bottom styles for alignment */
        .footer-bottom {
            display: flex;
            justify-content: space-between; /* Pushes items to ends */
            align-items: center;
            padding: 1rem 0; /* Add some padding */
            border-top: 1px solid rgba(255, 255, 255, 0.1); /* Optional separator */
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 1rem; /* Add gap for wrapped items */
        }

        .footer-social {
            display: flex;
            gap: 1rem; /* Space between icons */
        }
        
        .social-icon i {
            font-size: 1.4rem; /* Adjust icon size if needed */
            transition: color 0.3s ease, transform 0.1s ease; /* Added transform transition */
            display: block; /* Ensure icon behaves like a block */
            pointer-events: auto; /* Ensure clicks are registered on the icon */
        }

        .social-icon:hover i {
             color: #E50914; /* Netflix red hover */
        }
        
        /* Add active state for click feedback */
        .social-icon:active i {
            transform: scale(0.9); /* Slightly shrink icon on click */
            color: #b70710; /* Darker red on click */
        }

        .footer-bottom p {
            margin: 0; /* Remove default margin */
            font-size: 0.9rem;
            color: #ffffff; /* Changed to white */
        }

        /* Responsive footer */
        @media (max-width: 768px) {
             .footer-bottom {
                justify-content: center; /* Center items when wrapped */
                text-align: center;
             }
        }

        /* Add CSS styles for the animations */
        .water-fill {
            transition: all 0.3s ease;
        }
        
        .bubble:hover .water-fill {
            filter: url(#water-turbulence) brightness(1.2);
        }
        
        .shine {
            transition: all 0.3s ease;
        }
        
        .bubble:hover .shine {
            opacity: 0.5;
            transform: translate(-5px, -5px);
        }
        
        @keyframes ripple {
            0% {
                transform: scale(1);
                opacity: 0.3;
            }
            100% {
                transform: scale(1.3);
                opacity: 0;
            }
        }

    </style>
    
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo"><i>pk</i></a>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="experience.html" class="nav-link">Experience</a></li>
                    <li class="nav-item"><a href="education.html" class="nav-link">Education</a></li>
                    <li class="nav-item"><a href="skills.html" class="nav-link active">Skills</a></li>
                    <li class="nav-item"><a href="projects.html" class="nav-link">Projects</a></li>
                </ul>
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Page Title -->
        <section class="page-title">
            <div class="container">
                <h1>My Skills</h1>
            </div>
        </section>

        <!-- Skills Section - Replaced with Bubbles -->
        <section class="skills-section" id="skills">
            <!-- Container for D3 SVG -->
            <div id="skill-tree-container"></div>
            
            <!-- Hidden card for displaying skill details -->
            <div id="skill-card" class="">
                <div class="card-content">
                    <h2 class="skill-name"></h2>
                    <p class="skill-description"></p>
                    <div class="projects-list"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="social-links">
                <a href="https://linkedin.com/in/pkowadkar" target="_blank" class="social-link">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="https://github.com/p-kowadkar" target="_blank" class="social-link">
                    <i class="fab fa-github"></i>
                </a>
                <a href="mailto:pk.kowadkar@gmail.com" class="social-link">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
            <p class="copyright">&copy; 2025 Pranav Kowadkar. All rights reserved.</p>
        </div>
    </footer>

    <!-- Chatbot Widget -->
    <div class="chatbot-widget">
        <div class="chatbot-toggle">
            <i class="fas fa-comment"></i>
        </div>
        <div class="chatbot-container">
            <div class="chatbot-header">
                <div class="chatbot-title">Pranav's AI Assistant</div>
                <button class="chatbot-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chatbot-messages"></div>
            <div class="chatbot-input">
                <input type="text" id="chatbot-input-field" placeholder="Type your message...">
                <button id="chatbot-send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Existing Scripts (if any) -->
    <script src="./static/js/main.js"></script> 
    
    <!-- Soap Bubble Skill Tree Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Skill data
            const skillData = {
                // Programming & Core Tools
                "Python": {
                    description: "Versatile scripting language for data science and ML",
                    projects: ["Gravitational Wave", "Financial Analysis", "Web Apps"],
                    mastery: 95
                },
                "PyTorch": {
                    description: "Deep learning framework for neuroimaging and ML",
                    projects: ["Neuroimaging", "LLM Fine-tuning", "Computer Vision"],
                    mastery: 92
                },
                "TensorFlow": {
                    description: "Deep learning framework for ML applications",
                    projects: ["Gravitational Wave", "Neural Networks", "Model Training"],
                    mastery: 85
                },
                "SQL": {
                    description: "Query optimization and database management",
                    projects: ["Data Warehousing", "Analytics", "Reporting"],
                    mastery: 90
                },
                "C++": {
                    description: "Performance computing and system development",
                    projects: ["Dassault CATIA", "Memory Optimization", "Linux"],
                    mastery: 80
                },
                "C#": {
                    description: "Legacy banking systems and enterprise applications",
                    projects: ["Cognizant Banking", "Transaction Processing"],
                    mastery: 78
                },
                // Data Science & ML
                "NumPy": {
                    description: "High-performance numerical computing",
                    projects: ["Statistical Analysis", "Data Processing"],
                    mastery: 90
                },
                "Pandas": {
                    description: "Data wrangling and analysis",
                    projects: ["Data Engineering", "Analytics"],
                    mastery: 90
                },
                "Scikit-learn": {
                    description: "Traditional ML algorithms and pipelines",
                    projects: ["Various ML Projects", "Classification"],
                    mastery: 80
                },
                "Keras": {
                    description: "Neural network API for deep learning",
                    projects: ["Wave Detection", "Model Building"],
                    mastery: 82
                },
                // AI & LLMs
                "LLMs & Transformers": {
                    description: "Working with large language models",
                    projects: ["Neuroimaging Classification", "NLP"],
                    mastery: 92
                },
                "Fine-Tuning": {
                    description: "Customizing models for specific tasks",
                    projects: ["LLaMA Fine-tuning", "Domain Adaptation"],
                    mastery: 90
                },
                "Knowledge Distillation": {
                    description: "Compressing and optimizing models",
                    projects: ["LLM Distillation", "Model Optimization"],
                    mastery: 88
                },
                "Model Quantization": {
                    description: "Reducing model size and improving efficiency",
                    projects: ["Neuroimaging Models", "Edge Deployment"],
                    mastery: 86
                },
                "NLP": {
                    description: "Natural language processing and analysis",
                    projects: ["Financial Documents", "Text Analysis"],
                    mastery: 87
                },
                "RAG": {
                    description: "Retrieval Augmented Generation",
                    projects: ["Financial Document Analysis", "QA Systems"],
                    mastery: 85
                },
                "Prompt Engineering": {
                    description: "Crafting prompts for optimal LLM performance",
                    projects: ["GPT-4 Fine-tuning", "System Design"],
                    mastery: 88
                },
                // ML Operations & Engineering
                "MLOps": {
                    description: "Monitoring and managing ML systems",
                    projects: ["Anime Insights", "Model Deployment"],
                    mastery: 82
                },
                "Deep Learning": {
                    description: "Designing and training neural networks",
                    projects: ["Gravitational Wave", "Computer Vision"],
                    mastery: 90
                },
                "Feature Engineering": {
                    description: "Crafting and selecting features",
                    projects: ["HR Analytics", "ML Pipelines"],
                    mastery: 84
                },
                "Statistical Modeling": {
                    description: "Building probabilistic models",
                    projects: ["Gravitational Wave", "Analytics"],
                    mastery: 83
                },
                // Data Engineering & Infrastructure
                "Apache Spark": {
                    description: "Big data processing and analytics",
                    projects: ["Content Recommendation", "ETL"],
                    mastery: 88
                },
                "Airflow": {
                    description: "Orchestrating data pipelines",
                    projects: ["Recommendation Engine", "ETL"],
                    mastery: 87
                },
                "Data Warehousing": {
                    description: "Design and implementation",
                    projects: ["Snowflake", "Analytics"],
                    mastery: 83
                },
                "Kafka": {
                    description: "Real-time event streaming",
                    projects: ["Recommendation Engine", "Events"],
                    mastery: 80
                },
                "Elasticsearch": {
                    description: "Search engine and analytics",
                    projects: ["Recommendation Engine", "Search"],
                    mastery: 78
                },
                // Cloud & DevOps
                "AWS": {
                    description: "Cloud computing and infrastructure",
                    projects: ["Content Recommendation", "ML Deployment"],
                    mastery: 90
                },
                "Docker": {
                    description: "Containerization and deployment",
                    projects: ["Anime Insights", "Microservices"],
                    mastery: 85
                },
                "Git": {
                    description: "Version control and collaboration",
                    projects: ["Anime Insights", "Development"],
                    mastery: 88
                },
                "CI/CD": {
                    description: "Continuous Integration/Deployment",
                    projects: ["Anime Insights", "Automation"],
                    mastery: 80
                },
                "GCP": {
                    description: "Google Cloud Platform services",
                    projects: ["Cloud Computing", "ML"],
                    mastery: 40
                },
                "Azure": {
                    description: "Experience with Microsoft Azure",
                    projects: ["Bayer Campaign", "Data Factory"],
                    mastery: 78
                },
                "Google Colab": {
                    description: "Cloud-based development",
                    projects: ["Quick LLM Prototypes", "Research"],
                    mastery: 85
                },
                "Heroku": {
                    description: "Cloud PaaS deployment",
                    projects: ["Anime Insights", "Web Apps"],
                    mastery: 70
                },
                // Visualization & BI
                "Power BI": {
                    description: "Data visualization and analytics",
                    projects: ["Bayer Consumer Insights", "Dashboards"],
                    mastery: 85
                },
                "Tableau": {
                    description: "Visual analytics and reporting",
                    projects: ["Aerospace Analytics", "Dashboards"],
                    mastery: 85
                },
                "Looker Studio": {
                    description: "Google visualization platform",
                    projects: ["JerseySTEM Analytics", "Reports"],
                    mastery: 80
                },
                "Matplotlib": {
                    description: "Core plotting library",
                    projects: ["UAV Design", "Data Viz"],
                    mastery: 90
                },
                "Seaborn": {
                    description: "Statistical data visualization",
                    projects: ["UAV Dashboard", "Analytics"],
                    mastery: 85
                },
                "Plotly": {
                    description: "Interactive visualization",
                    projects: ["Gravitational Wave", "Dashboards"],
                    mastery: 84
                },
                "Dash": {
                    description: "Python framework for web analytics",
                    projects: ["Physicist Web Apps", "Dashboards"],
                    mastery: 80
                },
                // Specialized Tools
                "Jupyter Notebooks": {
                    description: "Go-to platform for data science",
                    projects: ["Research", "Analysis", "Prototyping"],
                    mastery: 95
                },
                "HuggingFace": {
                    description: "Library for transformer models",
                    projects: ["LLM Fine-tuning", "NLP"],
                    mastery: 88
                },
                "Tokenizers": {
                    description: "Converting text for LLMs",
                    projects: ["fMRI Voxel Processing", "NLP"],
                    mastery: 87
                },
                "Edge Deployment": {
                    description: "Deploying models to edge devices",
                    projects: ["LLM Quantization", "Optimization"],
                    mastery: 75
                },
                "Multithreading": {
                    description: "Parallel processing",
                    projects: ["Banking Systems", "Performance"],
                    mastery: 70
                },
                "Lambda Functions": {
                    description: "Serverless computing",
                    projects: ["Recommendation Engine", "APIs"],
                    mastery: 85
                },
                "API Gateway": {
                    description: "Managing APIs",
                    projects: ["Content Platform", "Services"],
                    mastery: 82
                },
                "DynamoDB": {
                    description: "NoSQL database",
                    projects: ["Recommendation Engine", "Storage"],
                    mastery: 78
                },
                "Azure Data Factory": {
                    description: "ETL pipeline service",
                    projects: ["Bayer Campaign", "Data Integration"],
                    mastery: 78
                },
                "Snowflake": {
                    description: "Cloud data platform",
                    projects: ["Bayer Healthcare", "Analytics"],
                    mastery: 82
                },
                "GitHub Actions": {
                    description: "Automation and CI/CD",
                    projects: ["Anime Insights", "DevOps"],
                    mastery: 82
                },
                "Prometheus": {
                    description: "Monitoring and alerting",
                    projects: ["Vaandu Pipeline", "Metrics"],
                    mastery: 82
                },
                "Grafana": {
                    description: "Dashboard and visualization",
                    projects: ["AWS Lambda", "Monitoring"],
                    mastery: 85
                }
            };
            
            // --- D3 Visualization Setup --- 
            const container = document.getElementById('skill-tree-container');
            if (!container) {
                console.error("Skill tree container not found!");
                return;
            }

            const width = container.clientWidth;
            const height = container.clientHeight;
            const centerX = width / 2;
            const centerY = height / 2;

            const svg = d3.select("#skill-tree-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("viewBox", `0 0 ${width} ${height}`);

            const defs = svg.append("defs");
            
            // Add turbulence filter for water movement
            const filter = defs.append("filter")
                .attr("id", "water-turbulence")
                .attr("x", "-50%")
                .attr("y", "-50%")
                .attr("width", "200%")
                .attr("height", "200%");

            // Create more complex turbulence
            const turbulence1 = filter.append("feTurbulence")
                .attr("type", "fractalNoise")
                .attr("baseFrequency", "0.02 0.05")
                .attr("numOctaves", "3")
                .attr("seed", "1")
                .attr("result", "turbulence1");

            const turbulence2 = filter.append("feTurbulence")
                .attr("type", "fractalNoise")
                .attr("baseFrequency", "0.05 0.02")
                .attr("numOctaves", "2")
                .attr("seed", "2")
                .attr("result", "turbulence2");

            // Animate both turbulence patterns
            turbulence1.append("animate")
                .attr("attributeName", "baseFrequency")
                .attr("dur", "15s")
                .attr("keyTimes", "0;0.25;0.5;0.75;1")
                .attr("values", "0.02 0.05;0.04 0.06;0.02 0.05;0.03 0.04;0.02 0.05")
                .attr("repeatCount", "indefinite");

            turbulence2.append("animate")
                .attr("attributeName", "baseFrequency")
                .attr("dur", "20s")
                .attr("keyTimes", "0;0.25;0.5;0.75;1")
                .attr("values", "0.05 0.02;0.03 0.04;0.05 0.02;0.04 0.03;0.05 0.02")
                .attr("repeatCount", "indefinite");

            // Combine turbulence effects
            filter.append("feComposite")
                .attr("in", "turbulence1")
                .attr("in2", "turbulence2")
                .attr("operator", "arithmetic")
                .attr("k1", "0.5")
                .attr("k2", "0.5")
                .attr("k3", "0.5")
                .attr("k4", "0")
                .attr("result", "combined");

            filter.append("feDisplacementMap")
                .attr("in", "SourceGraphic")
                .attr("in2", "combined")
                .attr("scale", "15")
                .attr("xChannelSelector", "R")
                .attr("yChannelSelector", "B");

            // Enhanced water gradient with more color stops
            const waterGradient = defs.append("linearGradient")
                .attr("id", "water-gradient")
                .attr("x1", "0%")
                .attr("y1", "100%")
                .attr("x2", "0%")
                .attr("y2", "0%");

            waterGradient.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", "rgba(229, 9, 20, 0.5)");

            waterGradient.append("stop")
                .attr("offset", "30%")
                .attr("stop-color", "rgba(229, 9, 20, 0.3)");

            waterGradient.append("stop")
                .attr("offset", "70%")
                .attr("stop-color", "rgba(229, 9, 20, 0.2)");

            waterGradient.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", "rgba(229, 9, 20, 0.1)");

            // Add animated wave patterns
            const wavePattern1 = defs.append("pattern")
                .attr("id", "wave-pattern-1")
                .attr("patternUnits", "userSpaceOnUse")
                .attr("width", "200")
                .attr("height", "200")
                .attr("patternTransform", "rotate(45)");

            wavePattern1.append("path")
                .attr("d", "M0,100 Q50,80 100,100 T200,100")
                .attr("fill", "none")
                .attr("stroke", "rgba(229, 9, 20, 0.2)")
                .attr("stroke-width", "20");

            wavePattern1.append("animateTransform")
                .attr("attributeName", "patternTransform")
                .attr("type", "translate")
                .attr("from", "0 0")
                .attr("to", "200 0")
                .attr("dur", "8s")
                .attr("repeatCount", "indefinite");

            const wavePattern2 = defs.append("pattern")
                .attr("id", "wave-pattern-2")
                .attr("patternUnits", "userSpaceOnUse")
                .attr("width", "200")
                .attr("height", "200")
                .attr("patternTransform", "rotate(-45)");

            wavePattern2.append("path")
                .attr("d", "M0,100 Q50,120 100,100 T200,100")
                .attr("fill", "none")
                .attr("stroke", "rgba(229, 9, 20, 0.15)")
                .attr("stroke-width", "15");

            wavePattern2.append("animateTransform")
                .attr("attributeName", "patternTransform")
                .attr("type", "translate")
                .attr("from", "0 0")
                .attr("to", "-200 0")
                .attr("dur", "12s")
                .attr("repeatCount", "indefinite");

            const skills = Object.entries(skillData).map(([name, data]) => ({
                id: name.replace(/[^a-zA-Z0-9_-]/g, '-'), // Sanitize for valid selector
                name,
                ...data,
                radius: Math.max(40, 25 + name.length * 2.5)
            }));

            const simulation = d3.forceSimulation(skills)
                .force("center", d3.forceCenter(centerX, centerY).strength(0.05))
                .force("collide", d3.forceCollide().radius(d => d.radius + 8).strength(0.7))
                .force("charge", d3.forceManyBody().strength(15))
                .alphaDecay(0.005)
                .velocityDecay(0.2);

            const bubbles = svg.selectAll(".bubble")
                .data(skills, d => d.id)
                .enter()
                .append("g")
                .attr("class", "bubble")
                .attr("id", d => `bubble-${d.id}`)
                .style("opacity", 0)
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            // Add bubble background
            bubbles.append("circle")
                .attr("r", d => d.radius)
                .attr("fill", "rgba(20, 20, 20, 0.6)")
                .attr("stroke", "#E50914")
                .attr("stroke-width", 2)
                .attr("stroke-opacity", 0.4);

            // Add water fill with clip path
            bubbles.each(function(d) {
                const bubble = d3.select(this);
                
                // Create clip path for water
                const clipPath = bubble.append("clipPath")
                    .attr("id", d => `clip-${d.id}`);
                
                clipPath.append("circle")
                    .attr("r", d => d.radius);

                // Add first wave layer
                bubble.append("rect")
                    .attr("x", -d.radius)
                    .attr("y", d.radius - (d.radius * 2 * (d.mastery / 100)))
                    .attr("width", d.radius * 2)
                    .attr("height", d.radius * 2)
                    .attr("fill", "url(#wave-pattern-1)")
                    .attr("clip-path", `url(#clip-${d.id})`)
                    .attr("class", "water-wave")
                    .style("opacity", 0.3)
                    .style("mix-blend-mode", "soft-light");

                // Add second wave layer
                bubble.append("rect")
                    .attr("x", -d.radius)
                    .attr("y", d.radius - (d.radius * 2 * (d.mastery / 100)))
                    .attr("width", d.radius * 2)
                    .attr("height", d.radius * 2)
                    .attr("fill", "url(#wave-pattern-2)")
                    .attr("clip-path", `url(#clip-${d.id})`)
                    .attr("class", "water-wave")
                    .style("opacity", 0.2)
                    .style("mix-blend-mode", "soft-light");

                // Add main water fill with turbulence
                bubble.append("rect")
                    .attr("x", -d.radius)
                    .attr("y", d.radius - (d.radius * 2 * (d.mastery / 100)))
                    .attr("width", d.radius * 2)
                    .attr("height", d.radius * 2)
                    .attr("fill", "url(#water-gradient)")
                    .attr("clip-path", `url(#clip-${d.id})`)
                    .attr("class", "water-fill")
                    .style("mix-blend-mode", "soft-light")
                    .style("filter", "url(#water-turbulence)");

                // Add shine effect
                bubble.append("circle")
                    .attr("r", d.radius * 0.8)
                    .attr("fill", "url(#shine-gradient)")
                    .attr("clip-path", `url(#clip-${d.id})`)
                    .attr("class", "shine")
                    .style("opacity", 0.3)
                    .attr("transform", "translate(-10, -10)");
            });

            // Add text last to ensure it's on top
            bubbles.append("text")
                .text(d => d.name)
                .attr("text-anchor", "middle")
                .attr("dy", ".3em")
                .style("font-size", d => `${Math.max(10, d.radius / 3.5)}px`);

            // Add mastery percentage
            bubbles.append("text")
                .text(d => `${d.mastery}%`)
                .attr("text-anchor", "middle")
                .attr("dy", "2em")
                .style("font-size", d => `${Math.max(8, d.radius / 4)}px`)
                .style("fill", "rgba(255, 255, 255, 0.7)");

            bubbles.transition()
                .duration(800)
                .delay((d, i) => i * 50)
                .style("opacity", 1);

            // Add ripple animation
            function addRippleAnimation() {
                bubbles.selectAll(".ripple")
                    .transition()
                    .duration(2000)
                    .attr("r", d => d.radius * 1.2)
                    .style("opacity", 0)
                    .transition()
                    .duration(0)
                    .attr("r", d => d.radius - 2)
                    .style("opacity", 1)
                    .on("end", addRippleAnimation);
            }

            addRippleAnimation();

            simulation.on("tick", () => {
                bubbles.attr("transform", d => `translate(${d.x},${d.y})`);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.1).restart();
                d.fx = d.x;
                d.fy = d.y;
                d3.select(this).raise().classed("active", true);
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                if (!d3.select(this).classed('clicked')) {
                    d.fx = null;
                    d.fy = null;
                }
                d3.select(this).classed("active", false);
            }

            bubbles.on("mouseover", function(event, d) {
                 if (d3.select("#skill-card").classed('visible')) return;
                 
                 d3.select(this).raise();
                 d3.select(this).select("circle")
                    .transition().duration(200)
                    .attr("stroke-opacity", 1)
                    .attr("stroke-width", 3)
                    .style("filter", "drop-shadow(0 0 8px rgba(229, 9, 20, 0.7))");
                    
                 d3.select(this)
                    .transition().duration(200)
                    .attr("transform", `translate(${d.x},${d.y}) scale(1.1)`); 
            })
            .on("mouseout", function(event, d) {
                if (d3.select(this).classed('clicked')) return;

                d3.select(this).select("circle")
                    .transition().duration(200)
                    .attr("stroke-opacity", 0.4)
                    .attr("stroke-width", 2)
                    .style("filter", "none");
                    
                d3.select(this)
                    .transition().duration(200)
                    .attr("transform", `translate(${d.x},${d.y}) scale(1)`);
            });

            bubbles.on("click", function(event, d) {
                event.stopPropagation();
                const bubbleElement = d3.select(this);
                
                if (bubbleElement.classed('clicked')) return;

                d3.selectAll(".bubble.clicked").each(function(datum) {
                    d3.select(this).classed('clicked', false);
                    d3.select(this).transition().duration(300).style("opacity", 1);
                    if (datum.fx && datum.fy) {
                         datum.fx = null;
                         datum.fy = null;
                    } 
                });
                simulation.alphaTarget(0).restart();
                
                bubbleElement.classed('clicked', true);
                
                d.fx = d.x;
                d.fy = d.y;

                bubbleElement
                    .transition()
                    .duration(300)
                    .style("opacity", 0)
                    .attr("pointer-events", "none");

                const card = d3.select("#skill-card");
                const cardWidth = card.node().offsetWidth;
                const cardHeight = card.node().offsetHeight;

                let left = d.x;
                let top = d.y;

                if (left - cardWidth / 2 < 10) left = cardWidth / 2 + 10;
                if (left + cardWidth / 2 > width - 10) left = width - cardWidth / 2 - 10;
                
                if (top - cardHeight / 2 < 10) top = cardHeight / 2 + 10;
                if (top + cardHeight / 2 > height - 10) top = height - cardHeight / 2 - 10;
                
                card.style("left", `${left}px`)
                    .style("top", `${top}px`)
                    .classed("visible", true);

                card.select(".skill-name").text(d.name);
                card.select(".skill-description").text(d.description);
                
                const projectsList = card.select(".projects-list");
                projectsList.html("");
                d.projects.forEach(project => {
                    projectsList.append("div")
                        .attr("class", "project-item")
                        .text(project);
                });
                
                card.datum(d);
            });

            d3.select("body").on("click.cardClose", function(event) {
                const card = d3.select("#skill-card");
                const clickedBubbleData = card.datum();

                // Check if click is outside the card and not on any bubble
                if (card.classed('visible') && 
                    !card.node().contains(event.target) && 
                    !event.target.closest('.bubble')) { // Use DOM closest directly
                    
                    card.classed("visible", false).datum(null);
                    
                    if (clickedBubbleData) {
                        const clickedBubble = d3.select(`#bubble-${clickedBubbleData.id}`);
                        if (clickedBubble.node()) { // Check if bubble exists
                            clickedBubble
                               .classed('clicked', false)
                               .attr("pointer-events", "auto")
                               .transition()
                               .duration(300)
                               .style("opacity", 1);
                            
                            clickedBubbleData.fx = null;
                            clickedBubbleData.fy = null;
                            simulation.alphaTarget(0).restart();
                        }
                    }
                }
            });
            
             window.addEventListener('resize', () => {
                const newWidth = container.clientWidth;
                const newHeight = container.clientHeight;
                
                svg.attr("width", newWidth).attr("height", newHeight)
                   .attr("viewBox", `0 0 ${newWidth} ${newHeight}`);
                   
                simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2))
                          .alpha(0.3).restart();
            });
        });
    </script>
    <!-- Chatbot Script -->
    <script src="./static/js/chatbot.js"></script>
</body>
</html> 